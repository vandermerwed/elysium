---
import Layout from "@layouts/Layout.astro";
import Main from "@layouts/Main.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Pagination from "@components/Pagination.astro";
import JournalCard from "@components/JournalCard.astro";
import { getContentHash, getSeqNum } from "@utils/marginalia";
import { SITE } from "@config";
import type { Page } from "astro";
import type { CollectionEntry } from "astro:content";

export interface Props {
  page: Page<CollectionEntry<"journal">>;
  activeNav?: "notes" | "writing" | "journal" | "projects";
  pageTitle?: string;
  pageDesc?: string;
  basePath?: string;
}

const {
  page,
  activeNav = "journal",
  pageTitle = "Journal",
  pageDesc = "Personal updates, yearly themes, and tools.",
  basePath = "journal",
} = Astro.props;
---

<Layout title={`${pageTitle} | ${SITE.title}`}>
  <Header activeNav={activeNav} />
  <Main pageTitle={pageTitle} pageDesc={pageDesc} count={page.total}>
    <ul>
      {
        page.data.map(({ data, id }, i) => (
          <JournalCard
            href={`/${basePath}/${id}/`}
            title={data.title}
            pubDatetime={data.pubDatetime}
            modDatetime={data.modDatetime}
            description={data.description}
            wordCount={data.wordCount}
            readingTime={data.readingTime}
            type={data.type}
            contentHash={getContentHash(data.description || id)}
            seqNum={getSeqNum(page.start + i, page.total)}
          />
        ))
      }
    </ul>
  </Main>

  <Pagination {page} />

  <Footer noMarginTop={page.lastPage > 1} />
</Layout>
