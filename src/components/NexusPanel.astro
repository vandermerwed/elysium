---
export interface Props {
  nexusScore: string;
  incomingCount: number;
  outgoingCount: number;
  externalCount: number;
}

const { nexusScore, incomingCount, outgoingCount, externalCount } = Astro.props;

const nexusScorePattern = /^(H|R|T)_(Fragment|Basic|Developed|Advanced|Integrated)$/;
const match = nexusScore.match(nexusScorePattern);

const topologyMap: Record<string, string> = { H: "Hub", R: "Relay", T: "Terminal" };
const topology = match ? topologyMap[match[1]] ?? match[1] : "—";
const stage = match ? match[2] : "—";
---

<div class="nexus-panel">
  <div class="nexus-header">
    <span class="nexus-prefix" aria-hidden="true">::</span>
    <span class="nexus-title">Nexus</span>
    <span class="nexus-rule" aria-hidden="true"></span>
  </div>
  <div class="nexus-body">
    <div class="nexus-row">
      <span class="nexus-label">stage</span>
      <span class="nexus-dots" aria-hidden="true"></span>
      <span class="nexus-value">{stage}</span>
      <span class="nexus-spacer"></span>
      <span class="nexus-label">topology</span>
      <span class="nexus-dots" aria-hidden="true"></span>
      <span class="nexus-value">{topology}</span>
    </div>
    <div class="nexus-row">
      <span class="nexus-label">incoming</span>
      <span class="nexus-dots" aria-hidden="true"></span>
      <span class="nexus-value">{incomingCount}</span>
      <span class="nexus-spacer"></span>
      <span class="nexus-label">outgoing</span>
      <span class="nexus-dots" aria-hidden="true"></span>
      <span class="nexus-value">{outgoingCount}</span>
      <span class="nexus-spacer"></span>
      <span class="nexus-label">external</span>
      <span class="nexus-dots" aria-hidden="true"></span>
      <span class="nexus-value">{externalCount}</span>
    </div>
  </div>
</div>

<style>
  .nexus-panel {
    @apply my-6 border font-mono text-sm;
    border-color: rgb(var(--color-border));
  }
  .nexus-header {
    @apply flex items-center gap-3 px-4 pt-3 font-mono text-sm uppercase tracking-wider;
    color: rgb(var(--color-text-base));
  }
  .nexus-prefix {
    @apply text-skin-accent;
  }
  .nexus-title {
    @apply whitespace-nowrap font-semibold;
  }
  .nexus-rule {
    @apply flex-1;
    border-bottom: 1px solid rgb(var(--color-border));
  }
  .nexus-body {
    @apply flex flex-col gap-1 px-4 py-3;
  }
  .nexus-row {
    @apply flex flex-wrap items-baseline gap-1;
    color: rgb(var(--color-base));
  }
  .nexus-label {
    @apply whitespace-nowrap text-xs;
  }
  .nexus-dots {
    @apply flex-grow;
    min-width: 1ch;
    border-bottom: 1px dotted rgb(var(--color-border-muted));
    position: relative;
    top: -3px;
  }
  .nexus-value {
    @apply whitespace-nowrap;
    color: rgb(var(--color-text-base));
  }
  .nexus-spacer {
    @apply w-4;
  }
</style>
